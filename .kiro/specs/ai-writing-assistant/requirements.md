# 需求文档

## 简介

本文档规定了基于 LangChain DeepAgent 框架构建的 AI 写作助手的需求。该系统通过 Web 界面（ag-ui）提供智能写作支持，集成模型上下文协议（MCP）以实现可扩展性，集成 Claude Skills 以提供专业能力，并提供全面的任务管理系统。该助手帮助用户完成整个写作生命周期：从捕捉灵感和规划内容，到起草和完善文本，再到发布精美作品。

## 术语表

- **DeepAgent（深度智能体）**: 基于 LangChain 的智能体框架，支持深度规划、长期任务、文件系统上下文管理和子智能体生成
- **MCP（模型上下文协议）**: 一个开放协议，标准化应用程序向 AI 模型提供工具和上下文的方式，实现模块化组件集成
- **Claude Skills（Claude 技能）**: Anthropic 的模块化能力扩展，为特定任务提供专业指令和脚本
- **ag-ui（智能体用户界面）**: 与写作助手交互的基于 Web 的用户界面
- **LangGraph**: DeepAgent 底层的工作流执行引擎
- **写作助手系统**: 包括 DeepAgent 后端、MCP 模块、Claude Skills 和 ag-ui 前端的完整系统
- **任务规划**: DeepAgent 将复杂写作目标分解为离散、可管理步骤的过程
- **子智能体**: 由主 DeepAgent 生成的隔离智能体，用专用上下文处理特定子任务
- **上下文文件**: 由 DeepAgent 文件系统管理的文件，用于存储草稿、笔记、计划和其他写作工件
- **长期记忆**: 跨会话持久存储用户偏好、写作风格示例和知识
- **技能插件**: 为助手添加特定写作能力（风格、语气、语言）的模块化扩展

## 需求

### 需求 1：任务规划与分解

**用户故事：** 作为一名写作者，我希望 AI 能将复杂的写作项目分解为可管理的步骤，以便我能系统地处理大型项目而不感到不知所措。

#### 验收标准

1. WHEN 用户提供写作目标时，THEN 写作助手系统 SHALL 分析目标并生成包含离散步骤的结构化计划
2. WHEN 生成计划时，THEN 写作助手系统 SHALL 使用 write_todos 工具创建任务清单（例如：大纲创建、章节起草、修订）
3. WHEN 执行计划时，THEN 写作助手系统 SHALL 跟踪每个步骤的进度并更新任务状态
4. WHEN 写作过程中出现新信息时，THEN 写作助手系统 SHALL 动态调整计划以纳入变化
5. WHEN 计划步骤完成时，THEN 写作助手系统 SHALL 自动进入下一步骤或提示用户指示方向

### 需求 2：文件系统上下文管理

**用户故事：** 作为处理长文档的写作者，我希望系统能高效管理大量文本和参考资料，以便我不会丢失上下文或遇到令牌限制。

#### 验收标准

1. WHEN 用户提供参考资料或草稿时，THEN 写作助手系统 SHALL 使用 write_file 将它们存储为上下文文件
2. WHEN 上下文超过合理的提示大小时，THEN 写作助手系统 SHALL 将内容外部化到文件而不是在每个提示中包含它
3. WHEN 助手需要引用存储的内容时，THEN 写作助手系统 SHALL 使用 read_file 按需检索特定信息
4. WHEN 编辑内容时，THEN 写作助手系统 SHALL 使用 edit_file 对存储的草稿进行批量修改
5. WHEN 组织内容时，THEN 写作助手系统 SHALL 使用 ls 和 grep 工具扫描和搜索存储的文件
6. WHEN 管理多个草稿版本时，THEN 写作助手系统 SHALL 为每个版本维护单独的文件以实现比较和回滚

### 需求 3：子智能体任务委派

**用户故事：** 作为写作者，我希望专业的 AI 智能体处理我写作的特定方面（研究、翻译、编辑），以便每个任务都能获得专注的专家关注。

#### 验收标准

1. WHEN 识别出专业任务（研究、翻译、风格编辑）时，THEN 写作助手系统 SHALL 使用 task 工具生成子智能体
2. WHEN 创建子智能体时，THEN 写作助手系统 SHALL 为其提供仅与其特定任务相关的隔离上下文
3. WHEN 子智能体完成任务时，THEN 写作助手系统 SHALL 通过基于文件的通信检索结果
4. WHEN 需要多个子智能体时，THEN 写作助手系统 SHALL 协调它们的执行以避免冲突
5. WHERE 需要研究时，THEN 写作助手系统 SHALL 委派给研究子智能体，该智能体查询外部来源并总结发现

### 需求 4：长期记忆与个性化

**用户故事：** 作为常规用户，我希望助手能跨会话记住我的写作风格和偏好，以便随着时间推移提供越来越个性化的建议。

#### 验收标准

1. WHEN 用户首次使用系统时，THEN 写作助手系统 SHALL 创建 /memories/ 目录用于持久存储
2. WHEN 用户提供写作样本时，THEN 写作助手系统 SHALL 分析并将风格特征存储在 /memories/style/ 中
3. WHEN 生成新内容时，THEN 写作助手系统 SHALL 引用存储的风格记忆以匹配用户的声音
4. WHEN 用户提供特定领域术语时，THEN 写作助手系统 SHALL 将定义存储在 /memories/glossary/ 中以供将来参考
5. WHEN 开始新会话时，THEN 写作助手系统 SHALL 从持久存储加载相关记忆以保持连续性

### 需求 5：MCP 组件集成

**用户故事：** 作为高级用户，我希望用外部工具和知识源扩展助手，以便我可以为特定的写作需求定制它。

#### 验收标准

1. WHEN 系统初始化时，THEN 写作助手系统 SHALL 发现可用的 MCP 服务器及其提供的工具
2. WHEN 连接 MCP 服务器时，THEN 写作助手系统 SHALL 使用 langchain-mcp-adapters 自动将其工具转换为 LangChain 兼容格式
3. WHEN 规划写作任务时，THEN 写作助手系统 SHALL 考虑可用的 MCP 工具并将它们纳入执行计划
4. WHERE 需要学术写作时，THEN 写作助手系统 SHALL 使用连接的学术数据库 MCP 工具搜索引用
5. WHERE 需要当前信息时，THEN 写作助手系统 SHALL 使用网络搜索 MCP 工具收集最新数据

### 需求 6：Claude 模型与技能集成

**用户故事：** 作为写作者，我希望访问 Claude 强大的语言能力和专业技能，以便我能制作高质量的专业内容。

#### 验收标准

1. WHEN 系统配置时，THEN 写作助手系统 SHALL 通过 Anthropic API 使用 Claude Sonnet 作为默认语言模型
2. WHEN 识别出专业写作任务时，THEN 写作助手系统 SHALL 加载相关的 Claude Skills 以增强性能
3. WHEN 加载技能时，THEN 写作助手系统 SHALL 将技能的指令和资源纳入智能体的上下文
4. WHERE 需要文本润色时，THEN 写作助手系统 SHALL 激活改善语法和风格的写作润色技能
5. WHEN 执行技能脚本时，THEN 写作助手系统 SHALL 在安全沙箱环境中运行它们

### 需求 7：富文本编辑界面

**用户故事：** 作为写作者，我希望有一个支持格式化、注释和 AI 建议的强大编辑器，以便我能在一个地方撰写和完善我的作品。

#### 验收标准

1. WHEN 用户打开编辑器时，THEN ag-ui SHALL 显示基于 TipTap 的富文本编辑区域
2. WHEN 用户输入时，THEN ag-ui SHALL 支持 Markdown 格式化和富文本功能
3. WHEN AI 提供建议时，THEN ag-ui SHALL 用差异可视化突出显示建议的更改
4. WHEN 用户选择文本时，THEN ag-ui SHALL 显示带有 AI 驱动编辑选项的浮动工具栏
5. WHEN 应用更改时，THEN ag-ui SHALL 更新文档并与后端同步

### 需求 8：对话式 AI 交互

**用户故事：** 作为写作者，我希望与 AI 聊天讨论我的写作，以便我能通过自然对话获得帮助、提问和接收建议。

#### 验收标准

1. WHEN 用户打开聊天面板时，THEN ag-ui SHALL 显示带有消息历史的对话界面
2. WHEN 用户发送消息时，THEN ag-ui SHALL 通过 API 将其传输到 DeepAgent 后端
3. WHEN 智能体响应时，THEN ag-ui SHALL 显示响应并支持流式传输以实现实时反馈
4. WHEN 智能体引用上下文文件时，THEN ag-ui SHALL 使这些引用可点击以便于导航
5. WHEN 对话涉及代码或结构化内容时，THEN ag-ui SHALL 用适当的格式渲染它

### 需求 9：上下文文件导航

**用户故事：** 作为写作者，我希望查看和导航 AI 正在管理的文件，以便我了解它使用的上下文并能验证其工作。

#### 验收标准

1. WHEN 用户打开文件侧边栏时，THEN ag-ui SHALL 显示 DeepAgent 管理的上下文文件列表
2. WHEN 用户点击文件时，THEN ag-ui SHALL 在只读视图中显示其内容
3. WHEN 智能体创建或修改文件时，THEN ag-ui SHALL 实时更新文件列表
4. WHEN 查看任务计划时，THEN ag-ui SHALL 显示带有当前进度的 /todos 文件
5. WHEN 查看记忆时，THEN ag-ui SHALL 显示 /memories/ 目录中的文件及其用途

### 需求 10：写作任务管理

**用户故事：** 作为管理多个项目的写作者，我希望组织我的写作任务并轻松切换它们，以便我能在不同作品之间工作而不会混淆。

#### 验收标准

1. WHEN 用户创建新项目时，THEN ag-ui SHALL 初始化具有专用上下文的新工作区
2. WHEN 用户切换项目时，THEN ag-ui SHALL 加载适当的工作区及其关联文件
3. WHEN 查看项目列表时，THEN ag-ui SHALL 显示带有预览信息的最近项目
4. WHEN 项目处于活动状态时，THEN ag-ui SHALL 显示其当前状态和下一步计划步骤
5. WHEN 组织项目时，THEN ag-ui SHALL 支持分类和搜索功能

### 需求 11：AI 驱动的写作工具

**用户故事：** 作为写作者，我希望快速访问常见写作任务的 AI 工具，以便我能高效改进我的工作而无需冗长的对话。

#### 验收标准

1. WHEN 用户选择文本并点击"继续写作"时，THEN 写作助手系统 SHALL 生成自然的续写
2. WHEN 用户点击"总结"时，THEN 写作助手系统 SHALL 创建所选内容的简洁摘要
3. WHEN 用户点击"润色"时，THEN 写作助手系统 SHALL 改善所选文本的语法、清晰度和风格
4. WHEN 用户点击"翻译"时，THEN 写作助手系统 SHALL 将文本转换为指定的目标语言
5. WHEN 用户点击"扩展"时，THEN 写作助手系统 SHALL 用额外细节详细阐述所选内容

### 需求 12：技能插件系统

**用户故事：** 作为开发者或高级用户，我希望向助手添加自定义写作技能，以便我能为特定领域或风格扩展其能力。

#### 验收标准

1. WHEN 新技能添加到技能目录时，THEN 写作助手系统 SHALL 在技能库中注册它
2. WHEN 技能注册时，THEN 写作助手系统 SHALL 解析其 SKILL.md 文件以了解其目的和指令
3. WHEN 用户激活技能时，THEN 写作助手系统 SHALL 将技能的指令注入智能体的系统提示
4. WHEN 技能提供工具时，THEN 写作助手系统 SHALL 使这些工具对智能体可用
5. WHERE 技能需要资源时，THEN 写作助手系统 SHALL 根据需要加载关联文件（模板、脚本、词典）

### 需求 13：写作风格定制

**用户故事：** 作为有特定声音的写作者，我希望配置 AI 以匹配我的写作风格，以便其建议对我的作品感觉真实。

#### 验收标准

1. WHEN 用户提供风格偏好时，THEN ag-ui SHALL 允许选择语气（正式、随意、学术、创意）
2. WHEN 用户上传写作样本时，THEN 写作助手系统 SHALL 分析它们以提取风格模式
3. WHEN 生成内容时，THEN 写作助手系统 SHALL 应用所选的风格偏好
4. WHEN 激活风格技能时，THEN 写作助手系统 SHALL 遵循技能的句子结构和词汇选择指南
5. WHEN 用户切换风格时，THEN ag-ui SHALL 更新活动技能并通知后端

### 需求 14：多语言支持

**用户故事：** 作为多语言写作者，我希望用不同语言写作和接收帮助，以便我能为不同受众创建内容。

#### 验收标准

1. WHEN 用户选择目标语言时，THEN ag-ui SHALL 配置助手以该语言操作
2. WHEN 用非英语语言生成内容时，THEN 写作助手系统 SHALL 使用适当的语言模型或翻译工具
3. WHEN 翻译内容时，THEN 写作助手系统 SHALL 保留格式并保持语义准确性
4. WHERE 存在特定语言技能时，THEN 写作助手系统 SHALL 在选择相应语言时加载它们
5. WHEN 切换语言时，THEN ag-ui SHALL 相应更新界面标签和占位符

### 需求 15：文件上传与处理

**用户故事：** 作为写作者，我希望上传参考文档和图像，以便 AI 能将它们纳入我的写作过程。

#### 验收标准

1. WHEN 用户上传文档文件时，THEN ag-ui SHALL 支持包括 txt、pdf、doc、docx、md、csv、xls、xlsx、ppt、pptx 在内的格式
2. WHEN 文件上传时，THEN 写作助手系统 SHALL 提取文本内容并将其存储为上下文文件
3. WHEN 用户上传图像时，THEN ag-ui SHALL 支持包括 jpg、png、jpeg、gif、bmp、webp 在内的格式
4. WHEN 图像上传时，THEN 写作助手系统 SHALL 分析它并提供描述或提取文本（如适用）
5. WHEN 处理上传的文件时，THEN ag-ui SHALL 显示进度并确认成功集成

### 需求 16：流式响应显示

**用户故事：** 作为写作者，我希望看到 AI 响应在生成时实时出现，以便我获得即时反馈并能在需要时中断。

#### 验收标准

1. WHEN 智能体生成响应时，THEN ag-ui SHALL 在文本到达时增量显示
2. WHEN 流式传输活动时，THEN ag-ui SHALL 显示输入指示器或光标
3. WHEN 用户想停止生成时，THEN ag-ui SHALL 提供中断流的取消按钮
4. WHEN 流式传输完成时，THEN ag-ui SHALL 将消息标记为完成并启用交互
5. WHEN 流式传输期间发生网络问题时，THEN ag-ui SHALL 优雅地处理错误并允许重试

### 需求 17：灵感与提示建议

**用户故事：** 作为面临写作障碍的写作者，我希望系统建议提示和想法，以便我能克服创意障碍并开始写作。

#### 验收标准

1. WHEN 用户打开空白文档时，THEN ag-ui SHALL 显示与项目类型相关的建议写作提示
2. WHEN 用户请求灵感时，THEN 写作助手系统 SHALL 基于当前上下文生成创意想法
3. WHEN 显示建议时，THEN ag-ui SHALL 按类别（问题、主题、角度）组织它们
4. WHEN 用户选择建议时，THEN ag-ui SHALL 将其插入编辑器或聊天作为起点
5. WHERE 存在社区示例时，THEN ag-ui SHALL 显示相关样本以激发想法

### 需求 18：版本历史与比较

**用户故事：** 作为迭代草稿的写作者，我希望跟踪我作品的不同版本，以便我能比较更改并在需要时恢复。

#### 验收标准

1. WHEN 用户保存草稿时，THEN 写作助手系统 SHALL 创建带有时间戳的版本化文件
2. WHEN 查看版本历史时，THEN ag-ui SHALL 显示带有日期和描述的已保存版本列表
3. WHEN 比较版本时，THEN ag-ui SHALL 显示突出显示更改的并排差异
4. WHEN 用户想恢复时，THEN ag-ui SHALL 允许将先前版本恢复为当前草稿
5. WHEN 版本累积时，THEN 写作助手系统 SHALL 高效管理存储并归档旧版本

### 需求 19：协作功能（可选）

**用户故事：** 作为与他人合作的写作者，我希望共享我的工作区并协作处理文档，以便我们能高效地一起写作。

#### 验收标准

1. WHERE 启用协作时，THEN ag-ui SHALL 允许邀请其他用户到工作区
2. WHERE 多个用户活动时，THEN ag-ui SHALL 显示在线指示器和实时光标
3. WHERE 发生冲突时，THEN 写作助手系统 SHALL 智能合并更改或提示解决
4. WHERE 配置权限时，THEN ag-ui SHALL 强制执行基于角色的访问（所有者、编辑者、查看者）
5. WHERE 需要评论时，THEN ag-ui SHALL 支持内联注释和线程讨论

### 需求 20：模型配置管理

**用户故事：** 作为用户，我希望能够配置和切换不同的 AI 模型，以便我能根据任务需求和成本考虑选择最合适的模型。

#### 验收标准

1. WHEN 用户打开模型设置时，THEN ag-ui SHALL 显示可用模型列表（Claude、GPT-4、本地模型等）
2. WHEN 用户选择模型时，THEN ag-ui SHALL 允许配置 API 密钥、端点 URL 和模型参数
3. WHEN 用户添加新模型时，THEN 写作助手系统 SHALL 验证配置并测试连接
4. WHEN 用户为不同任务配置模型时，THEN 写作助手系统 SHALL 允许设置默认模型、研究模型和润色模型
5. WHEN 模型配置更改时，THEN 写作助手系统 SHALL 保存配置并在下次会话中加载

### 需求 21：MCP 服务器配置

**用户故事：** 作为高级用户，我希望能够添加、配置和管理 MCP 服务器，以便我能扩展系统的工具和知识源。

#### 验收标准

1. WHEN 用户打开 MCP 设置时，THEN ag-ui SHALL 显示已配置的 MCP 服务器列表及其状态
2. WHEN 用户添加新 MCP 服务器时，THEN ag-ui SHALL 允许输入服务器名称、命令、参数和环境变量
3. WHEN 用户配置 MCP 服务器时，THEN ag-ui SHALL 提供常见 MCP 服务器的模板（学术搜索、网络搜索、数据库等）
4. WHEN MCP 服务器连接时，THEN 写作助手系统 SHALL 自动发现并注册其提供的工具
5. WHEN 用户禁用 MCP 服务器时，THEN 写作助手系统 SHALL 从可用工具列表中移除其工具
6. WHEN MCP 配置更改时，THEN 写作助手系统 SHALL 自动重新连接服务器而无需重启

### 需求 22：Claude Skills 包管理

**用户故事：** 作为用户，我希望能够上传和管理自定义 Claude Skills 包，以便我能为特定写作需求添加专业能力。

#### 验收标准

1. WHEN 用户打开技能管理界面时，THEN ag-ui SHALL 显示已安装技能的列表及其描述
2. WHEN 用户上传 Claude Skills 包时，THEN ag-ui SHALL 支持 .zip 格式的技能包文件
3. WHEN 技能包上传时，THEN 写作助手系统 SHALL 解析包结构、验证 SKILL.md 文件并提取元数据
4. WHEN 技能包包含脚本时，THEN 写作助手系统 SHALL 在沙箱环境中验证脚本安全性
5. WHEN 用户激活技能时，THEN 写作助手系统 SHALL 加载技能的指令、资源和工具
6. WHEN 用户删除技能时，THEN 写作助手系统 SHALL 移除技能文件并从技能库中注销
7. WHEN 技能包更新时，THEN ag-ui SHALL 允许用户上传新版本并保留用户配置

### 需求 23：配置导入导出

**用户故事：** 作为用户，我希望能够导出和导入我的配置，以便我能在不同设备间同步设置或与团队共享配置。

#### 验收标准

1. WHEN 用户请求导出配置时，THEN ag-ui SHALL 生成包含模型、MCP 和技能配置的 JSON 文件
2. WHEN 导出配置时，THEN 写作助手系统 SHALL 排除敏感信息（API 密钥）或提供加密选项
3. WHEN 用户导入配置文件时，THEN ag-ui SHALL 验证文件格式并显示将要应用的更改预览
4. WHEN 导入配置时，THEN 写作助手系统 SHALL 允许用户选择性导入部分配置（仅模型、仅 MCP 等）
5. WHEN 配置冲突时，THEN ag-ui SHALL 提示用户选择保留现有配置或覆盖

### 需求 24：性能与可扩展性

**用户故事：** 作为用户，我希望系统快速响应并处理大型文档，以便我的写作流程不会被技术限制中断。

#### 验收标准

1. WHEN 用户在编辑器中输入时，THEN ag-ui SHALL 对本地操作的响应延迟低于 100 毫秒
2. WHEN 智能体生成响应时，THEN 写作助手系统 SHALL 在请求后 2 秒内开始流式传输
3. WHEN 处理大型文档（>10,000 字）时，THEN 写作助手系统 SHALL 使用基于文件的上下文管理以避免性能下降
4. WHEN 多个用户访问系统时，THEN 后端 SHALL 水平扩展以保持响应时间
5. WHEN 加载界面时，THEN ag-ui SHALL 使用代码分割和延迟加载以最小化初始包大小
